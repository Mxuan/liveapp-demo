<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>58同城</title>
<link rel="stylesheet" type="text/css" href="style/shareAni.css"/>
<body>
	<div class="wrap-0">
		<div class="p-circle"></div>
		<div class="p-light"></div>
	</div>
	<section class="page-loading page">
		<div class="loading-div">
		<div class="pic-loading"></div>
		<div class="p-loading">加载中<span class="ani_dot">. . .</span>
		</div>
		</div>
	</section>
	<div class="wrap" id="scene" style="transform: translate3d(0px, 0px, 0px); backface-visibility: hidden;">
		<div class="sec" style="-webkit-transform: matrix(1, 0, 0, 1, 0, -2668);">
			<div class="bg">
				<div class="bg_sec bg01"></div>
				<div class="bg_sec bg02"></div>
				<div class="bg_sec bg03"></div>
				<div class="bg_sec bg04"></div>
				<div class="bg_sec bg05"></div>
				<div class="bg_sec bg06"></div>
				<div class="bg_sec bg07"></div>
				<div class="bg_sec bg08"></div>
			</div>
			<section class="sec01 page-1 page">
				<div class="p-null"></div>
				<div class="p1-head p-headAll opacity"></div>
				<div class="p1-submit opacity">
					<div class="p1-submit-line">到58APP畅快玩一次</div>
				</div>
				<div class="p1-ani">
					<div class="p1-sheep opacity">
						<div class="p1-sheep-open opacity2"></div>
					</div>
					<div class="p1-bottom opacity"></div>
				</div>
				<div class="p-arrowdown"></div>
			</section>
			<section class="sec02 page-2 page">
				<div class="p-null"></div>
				<div class="p2-head p-headAll opacity"></div>
				<div class="p2-ani">
					<div class="p2-flower"></div>
					<div class="p2-bubble1 opacity"></div>
					<div class="p2-bubble2 opacity"></div>
					<div class="p2-boy1 opacity"></div>
					<div class="p2-boy2 opacity">
						<div class="p2-boy2a"></div>
					</div>
				</div>
				<div class="p-arrowdown"></div>
			</section>
			<section class="sec03 page page-3">
				<div class="p-null"></div>
				<div class="p3-head p-headAll opacity"></div>
				<div class="p3-ani">
					<div class="p3-bubble1 opacity"></div>
					<div class="p3-bubble2 opacity"></div>
					<div class="p3-person opacity">
						<div class="p3-sweat opacity"></div>
					</div>
				</div>
				<div class="p-arrowdown"></div>
			</section>
			<section class="sec04 page page-4">
				<div class="p-null"></div>
				<div class="p4-head p-headAll opacity"></div>
				<div class="p4-ani">
					<div class="p4-bg opacity"></div>
					<div class="p4-ball opacity">
						<div class="p4-ball1"></div>
						<div class="p4-ball2"></div>
					</div>
					<div class="p4-bubble1 opacity"></div>
					<div class="p4-bubble2 opacity"></div>
					<div class="p4-bubble3 opacity"></div>
					<div class="p4-person1 opacity"></div>
					<div class="p4-person2 opacity"></div>
					<div class="p4-person3 opacity"></div>
				</div>
				<div class="p-arrowdown"></div>
			</section>
			<section class="sec05 page page-5">
				<div class="page-content">
					<p class="p-null"></p>
					<div class="opacity p5-head p-headAll"></div>
					<div class="p5-body">
						<div class="opacity p5-lboy"></div>
						<div class="opacity p5-ltalk"></div>
						<div class="opacity p5-rboy"></div>
						<div class="opacity p5-rtalk"></div>
						<div class="opacity p5-snow"></div>
					</div>
					<div class="paopao"></div>
				</div>
				<div class="p-arrowdown"></div>
			</section>
			<section class="sec06 page page-8">
				<div class="page-content">
					<p class="p-null"></p>
					<div class="opacity p8-head p-headAll"></div>
					<div class="opacity p8-body">
						<div class="opacity p8-tv"></div>
						<div class="opacity p8-goods"></div>
						<div class="opacity p8-talk"></div>
						<div class="opacity p8-boy"></div>
						<div class="opacity p8-music"></div>
					</div>
				</div>
				<div class="p-arrowdown"></div>
			</section>
			<section class="sec07 page page-9">
				<div class="page-content">
					<p class="p-null"></p>
					<div class="opacity p9-head p-headAll"></div>
					<div class="opacity p9-body"></div>
					<div class="opacity p9-bottom"></div>
				</div>
				<div class="p-arrowdown"></div>
			</section>
			<section class="sec08 page page-10">
				<div class="page-content">
					<p class="p-null"></p>
					<div class="p10-head p-headAll">
						<div class="opacity p10-talk1"></div>
						<div class="opacity p10-talk2"></div>
					</div>
					<div class="opacity p10-button">
						<div class="p10-submit-line">下载58同城客户端</div>
					</div>
					<div class="opacity p10-bottom">
						<div class="opacity p10-share"></div>
						<div class="p10-sheep"></div>
						<div class="p10-sheepe"></div>
						<div class="opacity p10-snow"></div>
					</div>
				</div>
			</section>
		</div>
	</div>
<script type="text/javascript" src="../common/js/zepto.min.js"></script>
<script>
	//加入埋点方法
	window.sendlog=function(userid, imei, openid, phone, pagetype, actiontype, params, ext){
	    // var url = "http://chunjie.static.58.com/dataapi/log/trackaction";
	    // url += "?";
	    // url += userid ? ("userid=" + userid) : "";
	    // url += imei ? ("&imei=" + imei) : "";
	    // url += openid ? ("&openid=" + openid) : "";
	    // url += phone ? ("&phone=" + phone) : "";
	    // url += pagetype ? ("&pagetype=" + pagetype) : "";
	    // url += actiontype ? ("&actiontype=" + actiontype) : "";
	    // url += params ? ("&params=" + params.join(",")) : "";
	    // url += ext ? ("&ext=" + ext.join(",")) : "";
	    // var img = new Image();
	    // img.src = url;
	}
    var touchStyle = function (obj, hover, fn) {
		//目前不是最佳方案，有待后期优化，使用事件代理替代事件绑定
        var timer = null, move2 = "", this_ = "", timer2 = null, tag_finger, isCheckBox = false;
        $(obj).removeClass(hover);
        if ($(obj).length > 0) {
            $(obj).unbind()
        }
        $(obj).bind("touchstart", function (e) {
            tag_finger = e.touches.length;
            if (tag_finger > 1)return;
            //处理IOS滑屏事件，招聘业务线列表出现checkbox时，处理滑屏不进入详情页面
            isCheckBox = false;
            if ($(e.srcElement).attr("class") == "job_choose") {
                isCheckBox = true;
            }
            this_ = $(this);
            move2 = "";
            timer = setTimeout(function () {
                this_.addClass(hover);
            }, 150);

        });
        $(obj).bind("touchmove", function (e) {
            if (tag_finger > 1)return;
            move2 = "move";
            clearTimeout(timer);
            $(this).removeClass(hover);
        });
        $(obj).bind("touchend", function () {
            if (tag_finger > 1 || isCheckBox)return;
            clearTimeout(timer);
            this_ = $(this);
            if (move2 == "move") {
                clearTimeout(timer);
                $(this).removeClass(hover);
            } else {
                $(this).addClass(hover);
                var this_ = $(this);
                timer2 = setTimeout(function () {
                    this_.removeClass(hover);
                    if (fn) {
                        fn(this_)
                    }
                }, 50);
            }
        });
        $(obj).bind("touchcancel", function () {
            clearTimeout(timer2);
            clearTimeout(timer);
            $(this).removeClass(hover);
        });
    };
	$(function(){
		resizeStyle();
		initPage();
		//吊起下载58APP
        // touchStyle($(".p10-button"),"",function(){
        //     window.sendlog("", "", "", "", "sharepage8", "clickdownload");
        //      invokeOrDownloadApp();
        // });
        // touchStyle($(".p1-submit"),"",function(){
        //      window.sendlog("", "", "", "", "sharepage1", "clickdownload");
        //      invokeOrDownloadApp();
        // })
        
        //传送门按钮点击
        $(".wrap-0").on("touchend",function(){
            window.sendlog("", "", "", "", window.nowpagetype, "clickin");
            animatePage(7);
        });
	});
	function resizeStyle(){
     	$(".page-loading").hide();
		$("#scene").css({"opacity":"1"});

		var sHeight=$("body").height();
		$(".page").css({"height":sHeight,"overflow":"hidden","width":"100%"});

		var sDistance2 = parseInt(($("body").height()-480)/2);
		var sDistance=(parseInt(sDistance2/2))>1?parseInt(sDistance2/2):1;
		// if(sHeight<480){
		// 	$(".p2-head").css({"margin-top":"20px"});
		// }
		$(".p-null").css({"height":sDistance});
		$(".p-headAll").css({"margin-bottom":sDistance2});
    }
	$(window).bind("resize",function(e){
		resizeStyle();
		onStart(e);
	});

	function orientationChange() {
		switch(window.orientation) {
			case 0:
				document.body.ontouchstart=function(){ return true}
				break;
		 	case -90:
				document.body.ontouchstart=function(){ return false}
				break;
			case 90:
				document.body.ontouchstart=function(){ return false}	
				break;
			case 180:
				document.body.ontouchstart=function(){ return false}
				break;
		};
	}
	orientationChange();
	window.onorientationchange = orientationChange;

	document.body.addEventListener('touchstart', function (e) {
	    //console.log("target:"+e.target.className);
	    e = e.changedTouches[0];
	    onStart(e);
	});
	document.body.addEventListener('touchmove', function (e) {
	    onMove(e.changedTouches[0], e);
	});
	
	document.body.addEventListener('touchend', function (e) {
	    onEnd(e.changedTouches[0]);
	});
	//
	window.onorientationchange = orientationChange;

	function initPage(){
		pageWidth = $(window).width();
		pageHeight = $(".wrap").height();
		pages = $(".wrap section");
		$(".bg .bg_sec").css("height",pageHeight);

	    var bg_sec_height = $('.bg .bg_sec').height();
	    // $(".svg").css("height",bg_sec_height*8);
	
	    $(".wrap section").css({
	        "width":pageWidth+"px",//"height":$(".wrap").height()+"px"
	        "height":pageHeight+"px"
	    });
	    //$(".wrap").height($(".wrap").height());
	
	    secHeight = pageHeight * $(".wrap section").length;
	    lineHeight = 832 * secHeight / pageHeight;
	
	    $(".sec, .line").addClass("drag");
	    animatePage(curPage);
	    //$(".sec, .line").removeClass("drag");
	}

	var startX = 0,
	    startY = 0;
	    margin = 0;
	var pages = null;
	var curPage = 0;
	var pageWidth = 0,
	    pageHeight = 0;
	var lineHeight = 0, secHeight = 0;
	var targetElement = null;
	var scrollPrevent = false, movePrevent = false, touchDown = false;
	function onStart (e) {
	    if(movePrevent == true){
	        event.preventDefault();
	        return false;
	    }
	    if($(e.target).parents("#container").length==1){
	        scrollPrevent = true;
	    }else{
	        scrollPrevent = false;
	    }
	
	    $(".map").on('click', function(e){
	    	$(".map_show").addClass("show");
	    })
	
	    if(!$(e.target).parents("#container").length==1){
		    $(".map_show").removeClass("show");
	    }
	
	    touchDown = true;
	
	    startX = e.pageX;
	    startY = e.pageY;
	    //margin = parseInt($(".sec").css("top"));
	    //-webkit-transform:translateY(0px)
	
	    //matrix(1, 0, 0, 1, 0, 8)
	
	    $(".sec, .line").addClass("drag");
	
	    margin = $(".sec").css("-webkit-transform");
	    //margin = "matrix(1, 0, 0, 1, 0, -50)";
	    margin = margin.replace("matrix(", "");
	    margin = margin.replace(")", "");
	    margin = margin.split(",");
	    margin = parseInt(margin[5]);
	}
	function onMove (e, oe) {
	    if(movePrevent == true || touchDown != true){
	        event.preventDefault();
	        return false;
	    }
	    event.preventDefault();
	    if( scrollPrevent==false && e.pageY!=startY){
            if(e.pageY<startY){
                if(curPage==7){
                    return false;
                }
            }
	        var temp = margin + e.pageY - startY;
	        $(".sec").css("-webkit-transform", "matrix(1, 0, 0, 1, 0, "+temp+")");
	        var b =  lineHeight / secHeight * temp;
	        $(".line").css("-webkit-transform", "matrix(1, 0, 0, 1, 0, "+b+")");
	    }
	}
	function onEnd (e) {
	    if(movePrevent == true){
	        event.preventDefault();
	        return false;
	    }
	
	    touchDown = false;
        if(e.pageY<startY){
            if(curPage==7){
                return false;
            }
        }
	    if( scrollPrevent==false ){
	        endX = e.pageX;
	        endY = e.pageY;
	        if( Math.abs(endY-startY)<=50) {
	            animatePage(curPage);
	        }else{
	        	if(endY>startY){
	        		prevPage();
	        	}else{
	        		nextPage();
	        	}
	        }
	    }
	    $(".sec, .line").removeClass("drag");
	}

	function prevPage(){
	    var newPage = curPage - 1;
	    animatePage(newPage);
	    
	}
	function nextPage(){
	    var newPage = curPage + 1;
	    animatePage(newPage);
	}
				
	function animatePage( newPage ){
	    if(newPage<0){
	        newPage = 0;
	    }
	    if(newPage>$(".wrap section").length-1){
	        newPage = $(".wrap section").length-1;
	    }
	
	    curPage = newPage;
	    var newMarginTop = newPage * (-pageHeight);
	    $(".sec").css({
	        "-webkit-transform" : "matrix(1, 0, 0, 1, 0, "+newMarginTop+")"
	    });
	
	    var newTop = -parseInt(curPage*pageHeight*(lineHeight/secHeight));
	    $(".line").css({
	        "-webkit-transform" : "matrix(1, 0, 0, 1, 0, "+newTop+")"
	    });
	
	    movePrevent = true;
	    setTimeout("movePrevent=false;", 300 );
	
	   	// if( !$(pages[curPage]).hasClass("sec0" + (curPage+1) + "_show") ){
	    //     $(pages[curPage]).addClass("sec0" + (curPage+1) + "_show");
	    // }
	    // $(pages[curPage-1]).removeClass("sec0" + (curPage) + "_show");
	    // $(pages[curPage+1]).removeClass("sec0" + (curPage+2) + "_show");
	
		//传送门按钮显示隐藏
	    if(curPage > 0 && curPage < 7){
	    	$(".wrap-0").show();
	    }else{
	    	$(".wrap-0").hide();
	    }
	    
	    if( !$(pages[curPage]).hasClass("page-show") ){
	        $(pages[curPage]).addClass("page-show");
	        //此处加页面展示埋点
	        // if(curPage==0||curPage>0){
	        // 	 window.nowpagetype="sharepage"+(curPage+1);
	        // 	  window.sendlog("", "", "", "", window.nowpagetype, "show");
	        // }
	    }
	    $(pages[curPage-1]).removeClass("page-show");
	    $(pages[curPage+1]).removeClass("page-show");
	}
	
	var scene = document.getElementById('scene');
</script>
</body>
</html>